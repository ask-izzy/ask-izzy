#!/usr/bin/env bash
set -euo pipefail
IFS=$'\n\t'
PATH=$(npm bin):$PATH

# Build components index
target=./src/components.js
files=$( find src/components -maxdepth 1 -name '*.js' | sort )

cat << EOF > $target
/* @flow */
/* DO NOT EDIT - Generated by $0. */
/* eslint-disable max-len */

EOF

for f in $files
do
    base=$( basename "${f%.js}" )
    echo "import $base from \"./components/$base\";" >> $target
done

echo "" >> $target
echo "export default {" >> $target

for f in $files
do
    base=$( basename "${f%.js}" )
    echo "    $base," >> $target
done

echo "};" >> $target

# Build personalisation index
target=./src/pages/personalisation.js
files=$( find src/pages/personalisation -name '*.js' | sort )

cat << EOF > $target
/* @flow */
/* DO NOT EDIT - Generated by $0. */
/* eslint-disable max-len */

EOF

for f in $files
do
    base=$( basename "${f%.js}" )
    echo "import $base from \"./personalisation/$base\";" >> $target
done

echo "" >> $target
echo "export default {" >> $target

for f in $files
do
    base=$( basename "${f%.js}" )
    echo "    $base," >> $target
done

echo "};" >> $target
